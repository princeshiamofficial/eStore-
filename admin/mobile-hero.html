<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Hero | Color Hut Studio</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #f97316;
            --primary-dark: #ea580c;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
        }
    </style>
</head>

<body class="flex h-screen overflow-hidden bg-slate-50">

    <!-- Sidebar -->
    <aside id="admin-sidebar"
        class="w-64 bg-white border-r border-slate-200 flex-shrink-0 flex flex-col z-20 hidden md:flex"></aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto">
        <!-- Top Navigation (Mobile) -->
        <header
            class="h-16 bg-white border-b border-slate-200 flex md:hidden items-center justify-between px-6 sticky top-0 z-20">
            <img src="/logo.png" alt="Color Hut" class="h-6">
            <button class="text-slate-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
        </header>

        <div class="p-6 md:p-10 max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-black text-slate-900 tracking-tight mb-2">Mobile Hero Slides</h1>
                    <p class="text-slate-500 font-medium">Manage images for the mobile homepage slider.</p>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8">
                <h3 class="text-lg font-bold text-slate-900 mb-4">Add New Slide</h3>
                <form id="uploadForm" class="flex flex-col gap-4">
                    <div class="flex items-center gap-4">
                        <input type="file" id="slideImage" name="image" accept="image/*,image/gif"
                            class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100 transition-colors"
                            required>
                        <button type="submit"
                            class="bg-orange-600 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-orange-700 transition-colors shadow-lg shadow-orange-600/20 whitespace-nowrap">
                            Upload Slide
                        </button>
                    </div>
                    <p class="text-sm text-slate-400">Recommended size: 800x600px (Aspect ratio 4:3). Supports JPG, PNG,
                        GIF.</p>
                </form>
            </div>

            <!-- Slides List -->
            <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-xl shadow-slate-200/50 p-8">
                <h3 class="text-xl font-bold text-slate-900 mb-6">Active Slides</h3>
                <div id="slidesList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Dynamic Content -->
                    <div class="animate-pulse bg-slate-100 h-48 rounded-xl"></div>
                    <div class="animate-pulse bg-slate-100 h-48 rounded-xl"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="/assets/admin-sidebar.js?v=3"></script>
    <script>
        async function loadSlides() {
            try {
                const response = await fetch('/api/hero-slides');
                const slides = await response.json();
                const container = document.getElementById('slidesList');

                if (slides.length === 0) {
                    container.innerHTML = `<p class="text-slate-400 col-span-full text-center py-8">No slides added yet.</p>`;
                    return;
                }

                container.innerHTML = slides.map(slide => `
                    <div class="relative group rounded-xl overflow-hidden border border-slate-200 shadow-sm">
                        <img src="${slide.image_url}" alt="Slide" class="w-full h-48 object-cover">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                            <button onclick="deleteSlide(${slide.id})" class="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading slides:', err);
            }
        }

        async function deleteSlide(id) {
            if (!confirm('Are you sure you want to delete this slide?')) return;
            try {
                const res = await fetch(`/api/hero-slides/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    loadSlides();
                } else {
                    alert('Failed to delete slide');
                }
            } catch (e) {
                console.error(e);
                alert('Error deleting slide');
            }
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const btn = e.target.querySelector('button');
            const originalText = btn.textContent;

            try {
                btn.disabled = true;
                btn.textContent = 'Uploading...';

                const res = await fetch('/api/hero-slides', {
                    method: 'POST',
                    body: formData
                });

                if (res.ok) {
                    e.target.reset();
                    loadSlides();
                } else {
                    const data = await res.json();
                    alert(data.error || 'Upload failed');
                }
            } catch (err) {
                console.error(err);
                alert('Error uploading slide');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });

        document.addEventListener('DOMContentLoaded', loadSlides);
    </script>
</body>

</html>