<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>{{OG_TITLE}}</title>

    <!-- Speed Optimization: Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">

    <!-- Social Sharing Meta Tags (Open Graph) -->
    <meta property="og:title" content="{{OG_TITLE}}">
    <meta property="og:description" content="{{OG_DESCRIPTION}}">
    <meta property="og:image" content="{{OG_IMAGE}}">
    <meta property="og:url" content="{{OG_URL}}">
    <meta property="og:type" content="product">
    <meta property="og:site_name" content="Color Hut">
    <meta property="og:locale" content="en_US">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{OG_TITLE}}">
    <meta name="twitter:description" content="{{OG_DESCRIPTION}}">
    <meta name="twitter:image" content="{{OG_IMAGE}}">
    <meta name="keywords" content="{{SEO_KEYWORDS}}">
    <link rel="canonical" href="{{OG_URL}}">
    <link rel="preload" href="{{OG_IMAGE}}" as="image" fetchpriority="high">

    <!-- Aggressive Indexing Directives -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">

    <!-- SEO: JSON-LD Product Schema -->
    {{{PRODUCT_SCHEMA}}}
    {{{BREADCRUMB_SCHEMA}}}

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" media="print" onload="this.media='all'">

    <style>
        :root {
            --primary: #f97316;
            --primary-dark: #ea580c;
            --accent: #4f46e5;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        img,
        video {
            -webkit-user-drag: none;
            user-select: none;
            pointer-events: none;
            /* Block extension detectors */
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .product-card {
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .product-card:hover {
            transform: translateY(-16px) scale(1.03);
            box-shadow: 0 40px 80px -15px rgba(0, 0, 0, 0.1);
            border-color: rgba(249, 115, 22, 0.3);
        }

        .shine-effect {
            position: relative;
            overflow: hidden;
        }

        .shine-effect::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 30%;
            height: 200%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: rotate(30deg);
            transition: all 0.9s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .product-card:hover .shine-effect::after {
            left: 150%;
        }

        .shimmer-sweep {
            position: relative;
            overflow: hidden;
            background: #f1f5f9;
        }

        .shimmer-sweep::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.4) 50%,
                    rgba(255, 255, 255, 0) 100%);
            transform: translateX(-100%);
            animation: shimmer-sweep-anim 1.5s infinite;
        }

        .shimmer-sweep.loaded::after {
            display: none;
        }

        @keyframes shimmer-sweep-anim {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }


        /* === STORE CARD (matches main site globals.css exactly) === */
        .related-store-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 32px 18px;
            padding: 12px 0 60px 0;
            width: 100%;
        }

        @media (max-width: 1100px) {
            .related-store-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (max-width: 900px) {
            .related-store-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 16px 12px;
            }
        }

        .rc-card {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: inherit;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            min-width: 0;
        }

        .rc-card:hover {
            transform: translateY(-2px);
        }

        .rc-image-box {
            position: relative;
            width: 100%;
            padding-top: 80%;
            border-radius: 16px;
            overflow: hidden;
            background: #fdfdfd;
            margin-bottom: 6px;
        }

        .rc-image-box img,
        .rc-video-hover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.2, 0, 0.2, 1);
        }

        .rc-card:hover .rc-image-box img {
            transform: scale(1.05);
        }

        .rc-play-overlay {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: #fff;
            color: #1a1a1a;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .rc-fav-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .rc-card:hover .rc-fav-btn {
            opacity: 1;
        }

        .rc-card-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .rc-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
        }

        .rc-prod-title {
            font-size: 14px;
            font-weight: 400;
            color: #1a1a1a;
            margin: 0;
            line-height: 1.4;
            white-space: normal;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2;
            flex: 1;
        }

        .rc-prod-rating {
            font-size: 12px;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            white-space: nowrap;
            font-weight: 400;
        }

        .rc-category-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 99px;
            display: inline-block;
            align-self: flex-start;
            margin-top: 8px;
            background-color: #f2f4f7;
            color: #475467;
            letter-spacing: 0.05em;
            text-transform: capitalize;
            transition: all 0.2s ease;
        }

        .rc-card:hover .rc-category-badge {
            background-color: #e0e7ff;
            color: #4338ca;
        }

        @media (max-width: 900px) {

            .rc-prod-rating,
            .rc-category-badge,
            .rc-fav-btn,
            .rc-play-overlay {
                display: none !important;
            }
        }

        /* video hover reveal */
        .rc-video-hover {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rc-card:hover .rc-video-hover {
            opacity: 1;
        }

        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            font-weight: 800;
            color: #0f172a;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-content h1 {
            font-size: 1.5em;
        }

        .markdown-content h2 {
            font-size: 1.3em;
        }

        .markdown-content h3 {
            font-size: 1.1em;
        }

        .markdown-content p {
            margin-bottom: 1em;
        }

        .markdown-content strong {
            font-weight: 700;
            color: #334155;
        }

        .markdown-content em {
            font-style: italic;
        }

        .markdown-content ul,
        .markdown-content ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }

        .markdown-content li {
            margin-bottom: 0.5em;
        }

        .markdown-content code {
            background-color: #f1f5f9;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .markdown-content a {
            color: #f97316;
            text-decoration: underline;
        }

        .markdown-content a:hover {
            color: #ea580c;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        ::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        html {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        @keyframes attract-pulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }

            50% {
                transform: scale(1.03);
                box-shadow: 0 20px 25px -5px rgba(249, 115, 22, 0.4), 0 10px 10px -5px rgba(249, 115, 22, 0.2);
            }
        }

        .animate-attract {
            animation: attract-pulse 2s infinite;
        }

        @media (max-width: 900px) {
            .video-icon-badge {
                display: none !important;
            }
        }
    </style>
</head>

<body class="text-slate-900 selection:bg-orange-100 selection:text-orange-900">

    <!-- Navigation removed as requested -->

    <main class="max-w-[1400px] mx-auto px-6 md:px-10 pt-10 pb-8 md:pt-16 md:pb-12">
        <!-- Breadcrumbs -->
        <nav id="breadcrumb-nav"
            class="flex items-center gap-2 text-xs md:text-sm font-bold uppercase tracking-widest text-slate-400 mb-8 overflow-x-auto whitespace-nowrap scrollbar-hide">
            <a href="javascript:history.back()"
                class="mr-2 p-1 -ml-1 text-slate-400 hover:text-orange-500 transition-colors" title="Go Back">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M10 19l-7-7m0 0l7-7m-7 7h18" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </a>
            <div class="h-4 w-px bg-slate-300 mx-2"></div>
            <a href="/" class="hover:text-orange-500 transition-colors">Home</a>
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M9 5l7 7-7 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span id="breadcrumb-cat" class="text-slate-400">Category</span>
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M9 5l7 7-7 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span id="breadcrumb-title" class="text-orange-500">Product Title</span>
        </nav>

        <div class="flex flex-col lg:flex-row gap-16 md:gap-24 mb-32" itemScope itemType="http://schema.org/Product"
            vocab="http://schema.org/" typeof="Product">
            <!-- Image Section -->
            <!-- Left Column Wrapper -->
            <div class="w-full lg:w-[720px] flex-shrink-0 flex flex-col gap-10">
                <div class="flex gap-4 md:gap-6 flex-col-reverse lg:flex-row h-auto lg:h-[600px]">
                    <!-- Thumbnails Column -->
                    <div class="flex lg:flex-col gap-3 md:gap-4 overflow-x-auto lg:overflow-y-auto scrollbar-hide py-2 lg:py-0 w-full lg:w-24 flex-shrink-0"
                        id="thumbnail-container">
                        <!-- Thumbnails injected via JS -->
                    </div>

                    <!-- Main Display Area -->
                    <div
                        class="w-full lg:w-[600px] aspect-square relative group rounded-xl overflow-hidden bg-white shadow-2xl border border-slate-100">
                        <div id="media-container" class="w-full h-full relative overflow-hidden">
                            <img id="product-img"
                                src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                                data-src="" class="w-full h-full object-contain transition-opacity duration-500"
                                alt="Product Image" fetchpriority="high" width="600" height="600" itemProp="image"
                                property="image">



                            <div id="video-frame" class="hidden w-full h-full">
                                <video class="w-full h-full object-cover"
                                    src="https://www.w3schools.com/html/mov_bbb.mp4" autoplay loop playsinline
                                    controls></video>
                            </div>
                        </div>

                        <!-- Navigation Arrows (Optional, can be hidden on mobile) -->
                        <button onclick="prevMedia()"
                            class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center shadow-lg hover:bg-orange-500 hover:text-white active:scale-95 active:bg-orange-600 transition-all opacity-0 group-hover:opacity-100 z-[100]">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M15 19l-7-7 7-7" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button onclick="nextMedia()"
                            class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center shadow-lg hover:bg-orange-500 hover:text-white active:scale-95 active:bg-orange-600 transition-all opacity-0 group-hover:opacity-100 z-[100]">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M9 5l7 7-7 7" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>

                        <div
                            class="absolute inset-0 pointer-events-none bg-gradient-to-t from-slate-900/10 to-transparent">
                        </div>
                    </div>
                </div>

                <!-- Side Related Gallery -->
                <div class="group/related mt-4">
                    <div class="mb-4">
                        <h3 class="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2">
                            <span class="w-8 h-0.5 bg-orange-500"></span>
                            Also in this collection
                        </h3>
                    </div>
                    <div class="relative px-2">
                        <button onclick="scrollRelated(-1)"
                            class="absolute left-0 top-1/2 -translate-y-1/2 z-10 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm border border-slate-200 flex items-center justify-center text-slate-400 hover:text-orange-500 hover:border-orange-500 transition-all shadow-sm opacity-0 group-hover/related:opacity-100 -translate-x-1/2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>

                        <div id="side-related-grid"
                            class="flex gap-4 overflow-x-auto scrollbar-hide scroll-smooth pb-1 px-1">
                            <!-- Injected via JS -->
                            <div class="bg-slate-100 rounded-xl animate-pulse w-24 h-24 flex-shrink-0"></div>
                            <div class="bg-slate-100 rounded-xl animate-pulse w-24 h-24 flex-shrink-0"></div>
                            <div class="bg-slate-100 rounded-xl animate-pulse w-24 h-24 flex-shrink-0"></div>
                        </div>

                        <button onclick="scrollRelated(1)"
                            class="absolute right-0 top-1/2 -translate-y-1/2 z-10 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm border border-slate-200 flex items-center justify-center text-slate-400 hover:text-orange-500 hover:border-orange-500 transition-all shadow-sm opacity-0 group-hover/related:opacity-100 translate-x-1/2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Content Section -->
            <div class="flex-1 flex flex-col justify-center">
                <div class="mb-8">
                    <span id="product-cat"
                        class="inline-block text-xs md:text-sm font-black uppercase tracking-[0.3em] text-orange-500 mb-4">Category</span>
                    <h1 id="product-title"
                        class="text-4xl md:text-6xl font-black tracking-tight text-slate-900 leading-tight mb-6"
                        itemProp="name" property="name">
                        Product
                        Title</h1>
                    <div id="product-rating" class="flex gap-1 items-center mb-8">
                        <!-- Stars injected via JS -->
                    </div>
                </div>

                <div class="space-y-8">
                    <div>
                        <h3 class="text-sm font-black uppercase tracking-[0.2em] text-slate-400 mb-4">The Studio
                            Vision
                        </h3>
                        <div id="product-desc"
                            class="markdown-content text-lg md:text-xl text-slate-500 leading-relaxed font-medium"
                            itemProp="description" property="description">
                            This premium design is part of our curated studio collection. Expertly crafted with
                            attention to detail, it embodies the minimalist elegance and functional excellence that
                            defines Color Hut's creative signature. Ideal for brands seeking to establish a
                            professional
                            and distinguished identity.
                        </div>
                    </div>

                    <div class="pt-8 border-t border-slate-200/60 flex flex-col md:flex-row gap-4">
                        <button onclick="inquireWhatsApp()"
                            class="flex-1 bg-slate-950 text-white px-12 py-5 rounded-[2rem] text-lg font-bold hover:bg-orange-600 transition-all shadow-2xl shadow-slate-300 active:scale-95 flex items-center justify-center gap-3 animate-attract">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.414 0 .018 5.396.015 12.03c0 2.12.541 4.189 1.57 6.007L0 24l6.135-1.61a11.803 11.803 0 005.911 1.6h.005c6.634 0 12.032-5.396 12.035-12.03a11.85 11.85 0 00-3.536-8.261" />
                            </svg>
                            WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products Section -->
        <section>
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12">
                <div>
                    <h2 class="text-3xl md:text-4xl font-black tracking-tight text-slate-900 mb-2">Related Creations
                    </h2>
                    <p class="text-slate-500 font-medium">Explore more items from this curated aesthetic category.
                    </p>
                </div>
                <a href="/"
                    class="group flex items-center gap-2 text-sm font-black uppercase tracking-widest text-orange-500 hover:text-orange-600 transition-colors">
                    View Full Collection
                    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M14 5l7 7-7 7M3 12h18" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </a>
            </div>

            <div id="related-grid" class="related-store-grid">
                <!-- Related products injected via JS -->
            </div>
        </section>
    </main>


    <script>
        // Global state
        let items = [];
        let categories = [];
        let currentCategory = 'All';
        let currentMediaIndex = 0;
        let galleryItems = [];

        // Shared Hosting Optimization: Thumbnail detection
        function getThumb(src) {
            if (!src || src.startsWith('blob:') || src.startsWith('data:')) return src;

            // Normalize: Ensure leading slash for local paths
            if (!src.startsWith('http') && !src.startsWith('/')) {
                src = '/' + src;
            }

            // Ensure /uploads/ prefix for files that are definitely uploads but lack the prefix
            if (src.includes('/opt-') && !src.includes('/uploads/') && !src.includes('/api/')) {
                src = '/uploads' + src;
            }

            // If it's already a watermarked URL, don't touch it further
            if (src.includes('/api/public/watermark/')) return src;

            // Use watermarked version for public view
            if (src.includes('/uploads/')) {
                return src.replace('/uploads/', '/api/public/watermark/');
            }

            if (src.includes('/opt-') && !src.includes('/thumb-')) {
                const parts = src.split('/');
                const filename = parts.pop();
                return parts.join('/') + '/thumb-' + filename;
            }
            return src;
        }

        const intersectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const src = el.getAttribute('data-pending-src');
                    if (src) {
                        el.removeAttribute('data-pending-src');
                        const prio = el.getAttribute('data-pending-priority') || 'auto';
                        el.removeAttribute('data-pending-priority');
                        intersectionObserver.unobserve(el);
                        secureMedia(el, src, prio);
                    }
                }
            });
        }, { rootMargin: '600px' });

        async function secureMedia(el, src, priority = 'auto') {
            if (!src || src.startsWith('blob:') || src.startsWith('data:')) return;
            try {
                const response = await fetch(src, { priority });
                const blob = await response.blob();

                if (el.tagName === 'IMG') {
                    const bitmap = await createImageBitmap(blob);
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d', { alpha: false });

                    // Optimized Downsampling
                    const maxDim = 1200;
                    let scale = 1;
                    if (bitmap.width > maxDim || bitmap.height > maxDim) {
                        scale = maxDim / Math.max(bitmap.width, bitmap.height);
                    }

                    canvas.width = bitmap.width * scale;
                    canvas.height = bitmap.height * scale;

                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(bitmap, 0, 0, canvas.width, canvas.height);
                    bitmap.close();

                    canvas.id = el.id;
                    canvas.className = el.className;
                    canvas.alt = el.alt;
                    canvas.style.cssText = el.style.cssText;
                    canvas.style.opacity = '0';
                    canvas.style.transition = 'opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1)';

                    const style = window.getComputedStyle(el);
                    canvas.style.width = (style.width && style.width !== '0px' && style.width !== 'auto' && !el.className.includes('w-full')) ? style.width : '100.1%';
                    canvas.style.height = (style.height && style.height !== '0px' && style.height !== 'auto' && !el.className.includes('h-full')) ? style.height : '100%';
                    canvas.style.objectFit = style.objectFit || 'contain';

                    canvas.setAttribute('data-ghost', 'true');
                    if (el.parentNode) {
                        el.parentNode.classList.add('loaded');
                        el.parentNode.replaceChild(canvas, el);
                    }

                    requestAnimationFrame(() => {
                        canvas.style.opacity = '1';
                    });
                } else if (el.tagName === 'VIDEO') {
                    const blobUrl = URL.createObjectURL(blob);
                    el.src = blobUrl;
                    el.setAttribute('controlsList', 'nodownload');
                    el.oncontextmenu = e => e.preventDefault();
                }
            } catch (e) {
                console.warn('SECURE MEDIA ERROR: Fallback to direct load', e);
                // Fallback: If fetch fails (e.g. CORS), load directly
                el.src = src;
                el.style.opacity = '1';
                if (el.parentNode) el.parentNode.classList.add('loaded');
            }
        }



        const mediaObserver = new MutationObserver((mutations) => {
            mutations.forEach(mutation => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(node => {
                        if (node.nodeType === 1) {
                            const targets = node.querySelectorAll('img[data-src]:not([data-ghost]), video[data-src]');
                            if (node.hasAttribute('data-src')) processNode(node);
                            targets.forEach(processNode);
                        }
                    });
                } else if (mutation.type === 'attributes' && mutation.attributeName === 'data-src') {
                    processNode(mutation.target);
                }
            });
        });

        function processNode(el) {
            const s = el.getAttribute('data-src');
            if (s && !el.hasAttribute('data-ghost')) {
                const isEager = el.getAttribute('loading') === 'eager';
                const priority = el.getAttribute('fetchpriority') || 'auto';

                el.removeAttribute('data-src');

                if (isEager) {
                    secureMedia(el, s, priority);
                } else {
                    el.setAttribute('data-pending-src', s);
                    el.setAttribute('data-pending-priority', priority);
                    intersectionObserver.observe(el);
                }
            }
        }

        mediaObserver.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['data-src']
        });



        function getParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const pathSegments = window.location.pathname.split('/');
            const slug = pathSegments[1] === 'p' ? pathSegments[2] : null;

            return {
                id: parseInt(urlParams.get('id')),
                slug: slug || urlParams.get('slug')
            };
        }

        function createStars(rating) {
            return Array.from({ length: 5 }, (_, i) =>
                `<svg class="w-5 h-5 ${i < rating ? 'text-orange-400 fill-current' : 'text-slate-200 fill-current'}" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`
            ).join('');
        }

        function parseMarkdown(text) {
            if (!text) return '';

            return text
                // Headers
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                // Bold
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Italic
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Code
                .replace(/`(.*?)`/g, '<code>$1</code>')
                // Links
                .replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                // Line breaks to paragraphs
                .split('\n\n').map(para => {
                    // Check if it's a list
                    if (para.trim().startsWith('-')) {
                        const items = para.split('\n').filter(line => line.trim().startsWith('-'))
                            .map(line => `<li>${line.trim().substring(1).trim()}</li>`).join('');
                        return `<ul>${items}</ul>`;
                    }
                    // Check if already wrapped in tag
                    if (para.trim().startsWith('<')) return para;
                    return `<p>${para.replace(/\n/g, '<br>')}</p>`;
                }).join('');
        }

        function scrollRelated(direction) {
            const container = document.getElementById('side-related-grid');
            if (container) {
                const scrollAmount = 200;
                container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
            }
        }

        async function fetchCategories() {
            try {
                const response = await fetch('/api/public/categories');
                const data = await response.json();
                if (Array.isArray(data)) {
                    categories = data;
                    renderCategoryNav();
                } else {
                    console.error('Expected categories array, but got:', data);
                    categories = [];
                }
            } catch (error) { console.error('Error fetching categories:', error); }
        }

        function playHoverVideo(el) {
            if (window.innerWidth <= 900) return;
            const video = el.querySelector('video');
            const img = el.querySelector('img');
            const icon = el.querySelector('.video-icon-badge');
            if (video) {
                video.play().catch(() => { });
                video.style.opacity = '1';
                if (img) img.style.opacity = '0';
                if (icon) icon.style.opacity = '0';
            }
        }

        function pauseHoverVideo(el) {
            const video = el.querySelector('video');
            const img = el.querySelector('img');
            const icon = el.querySelector('.video-icon-badge');
            if (video) {
                video.pause();
                video.currentTime = 0;
                video.style.opacity = '0';
                if (img) img.style.opacity = '1';
                if (icon) icon.style.opacity = '1';
            }
        }

        // ── Related-Creations card interactive behaviour ──────────────────
        function rcCardEnter(el) {
            if (window.innerWidth <= 900) return;

            // 1. Video hover-play (reuse existing helper)
            playHoverVideo(el);

            // 2. Multi-image slide
            const imgs = JSON.parse(el.dataset.images || '[]');
            if (imgs.length <= 1) return;
            let idx = 0;
            el._rcSlide = setInterval(() => {
                idx = (idx + 1) % imgs.length;
                const imgEl = el.querySelector('.rc-image-box img');
                if (imgEl) {
                    imgEl.style.opacity = '0';
                    setTimeout(() => {
                        imgEl.src = getThumb(imgs[idx]);
                        imgEl.style.opacity = '1';
                    }, 200);
                }
            }, 2500);
        }

        function rcCardLeave(el) {
            // Stop slide interval
            if (el._rcSlide) { clearInterval(el._rcSlide); el._rcSlide = null; }
            // Restore first image
            const imgs = JSON.parse(el.dataset.images || '[]');
            const imgEl = el.querySelector('.rc-image-box img');
            if (imgEl && imgs.length > 0) {
                imgEl.style.opacity = '0';
                setTimeout(() => { imgEl.src = getThumb(imgs[0]); imgEl.style.opacity = '1'; }, 200);
            }
            // Pause video
            pauseHoverVideo(el);
        }

        function encodeForAttr(arr) {
            return JSON.stringify(arr).replace(/"/g, '&quot;');
        }

        function enableDragToScroll(container) {
            if (!container) return;

            let isDown = false;
            let startX;
            let scrollLeft;
            let startY;
            let scrollTop;

            container.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - container.offsetLeft;
                startY = e.pageY - container.offsetTop;
                scrollLeft = container.scrollLeft;
                scrollTop = container.scrollTop;
                container.style.cursor = 'grabbing';
            });

            container.addEventListener('mouseleave', () => {
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mouseup', () => {
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                const x = e.pageX - container.offsetLeft;
                const y = e.pageY - container.offsetTop;
                const walkX = (x - startX) * 2;
                const walkY = (y - startY) * 2;
                if (Math.abs(walkX) < 5 && Math.abs(walkY) < 5) return;
                e.preventDefault();
                container.scrollLeft = scrollLeft - walkX;
                container.scrollTop = scrollTop - walkY;
            });

            // Set initial cursor
            container.style.cursor = 'grab';
            // Also enable for touch if needed, but browser handles touch drag-to-scroll by default.
            // This script is primarily for desktop mouse dragging.
        }

        function renderCategoryNav() {
            const desktopCategoryNav = document.getElementById('desktopCategoryNav');
            let topLinksHTML = createTopCatLink('All', 'All Products');
            const mainCategories = categories.filter(c => !c.parent_id);
            mainCategories.forEach(cat => {
                topLinksHTML += createTopCatLink(cat.name, cat.name);
            });
            if (desktopCategoryNav) desktopCategoryNav.innerHTML = topLinksHTML;
        }

        function createTopCatLink(id, name) {
            const cat = categories.find(c => c.name === id);
            const slug = cat ? cat.slug : '';
            return `
                <a href="/${slug}"
                   class="flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-xs md:text-sm transition-all hover:bg-white/10">
                    <span>${name}</span>
                    <svg class="w-3 h-3 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </a>`;
        }

        async function initPage() {
            await fetchCategories();
            enableDragToScroll(document.getElementById('breadcrumb-nav'));
            const { id, slug } = getParams();
            if (!id && !slug) {
                window.location.href = 'index.html';
                return;
            }

            try {
                // Fetch current product
                const fetchUrl = slug ? `/api/public/products/slug/${slug}` : `/api/public/products/${id}`;
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error('Product not found');
                const product = await response.json();

                // Update Details
                document.title = `${product.name} | Color Hut Studio`;
                document.getElementById('breadcrumb-cat').innerText = product.category_name || 'Uncategorized';
                document.getElementById('breadcrumb-title').innerText = product.name;
                document.getElementById('product-cat').innerText = product.category_name || 'Uncategorized';
                document.getElementById('product-title').innerText = product.name;

                const rating = parseFloat(product.rating) || 0;
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const starHTML = Array.from({ length: 5 }, (_, i) => {
                    let fillInfo = 'text-slate-200 fill-current';
                    if (i < fullStars) fillInfo = 'text-orange-400 fill-current';
                    else if (i === fullStars && hasHalfStar) fillInfo = 'text-orange-400 fill-current';
                    return `<svg class="w-5 h-5 ${fillInfo}" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
                }).join('');
                document.getElementById('product-rating').innerHTML = starHTML + `<span class="text-sm font-bold text-slate-400 ml-2">(${rating} / 5.0)</span>`;

                // Render markdown description
                const descHtml = parseMarkdown(product.description || 'This premium design is part of our curated studio collection.');
                document.getElementById('product-desc').innerHTML = descHtml;

                // Initialize Gallery
                let images = [];
                try {
                    images = product.image ? (product.image.startsWith('[') ? JSON.parse(product.image) : [product.image]) : [];
                } catch (e) { images = [product.image]; }

                galleryItems = images.map(url => {
                    if (!url) return { type: 'image', src: '' };
                    let src = url;
                    // Normalize leading slash
                    if (!src.startsWith('http') && !src.startsWith('/')) {
                        src = '/' + src;
                    }
                    // Ensure /uploads prefix
                    if (src.includes('/opt-') && !src.includes('/uploads/') && !src.includes('/api/')) {
                        src = '/uploads' + src;
                    }
                    // Apply watermark route
                    if (src.includes('/uploads/')) {
                        src = src.replace('/uploads/', '/api/public/watermark/');
                    }
                    return { type: 'image', src: src };
                });

                if (product.video_url) {
                    // Position video as the 2nd item if there are at least 1 image
                    if (galleryItems.length > 0) {
                        galleryItems.splice(1, 0, { type: 'video', src: product.video_url });
                    } else {
                        galleryItems.push({ type: 'video', src: product.video_url });
                    }
                }

                // If gallery is empty, add placeholder
                if (galleryItems.length === 0) {
                    galleryItems.push({ type: 'image', src: 'https://via.placeholder.com/600' });
                }

                renderGallery();

                // Fetch related products
                const relatedResponse = await fetch(`/api/public/related/${product.category_id}?exclude=${product.id}`);
                const related = await relatedResponse.json();

                const relatedGrid = document.getElementById('related-grid');
                relatedGrid.innerHTML = related.map(item => {
                    let images = [];
                    try {
                        images = item.image ? (item.image.startsWith('[') ? JSON.parse(item.image) : [item.image]) : [];
                    } catch (e) { images = [item.image]; }
                    const mainImage = images[0] || 'https://via.placeholder.com/400';

                    const relatedRating = item.rating || 0;
                    const relatedFullStars = Math.floor(relatedRating);
                    const relatedHasHalfStar = relatedRating % 1 >= 0.5;
                    const relatedStars = Array.from({ length: 5 }, (_, i) => {
                        let fillInfo = 'text-slate-200 fill-current';
                        if (i < relatedFullStars) fillInfo = 'text-orange-400 fill-current';
                        else if (i === relatedFullStars && relatedHasHalfStar) fillInfo = 'text-orange-400 fill-current';
                        return `<svg class="w-3 h-3 ${fillInfo}" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
                    }).join('');

                    const isPriority = related.indexOf(item) < 3;
                    const loadingAttr = isPriority ? 'eager' : 'lazy';
                    const priorityAttr = isPriority ? 'fetchpriority="high"' : '';

                    const hasVideo = !!item.video_url;

                    // Fake rating matching main store style
                    const fakeRating = (related.indexOf(item) % 2 === 0) ? '5.0' : '4.8';
                    const fakeCount = (((related.indexOf(item) + 1) * 342) % 3000);

                    return `
                        <a href="/p/${item.slug}" class="rc-card"
                           data-images="${encodeForAttr(images)}"
                           onmouseenter="rcCardEnter(this)" onmouseleave="rcCardLeave(this)">
                            <div class="rc-image-box">
                                <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                                     data-src="${getThumb(mainImage)}"
                                     style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;transition:opacity 0.2s;"
                                     alt="${item.name}"
                                     ${priorityAttr} loading="${loadingAttr}"
                                     width="400" height="320">
                                ${hasVideo ? `
                                    <video src="${item.video_url}" muted playsinline loop
                                           style="opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;transition:opacity 0.3s;"></video>
                                    <div class="rc-play-overlay">
                                        <svg width="10" height="12" viewBox="0 0 10 12" fill="currentColor"><path d="M0 0l10 6-10 6z"/></svg>
                                    </div>
                                ` : ''}
                                <button class="rc-fav-btn" onclick="event.preventDefault()" aria-label="Favourite">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                </button>
                            </div>
                            <div class="rc-card-info">
                                <div class="rc-title-row">
                                    <h3 class="rc-prod-title">${item.name}</h3>
                                    <div class="rc-prod-rating">
                                        <span style="font-weight:700">${fakeRating}</span>
                                        <span style="margin:0 1px">★</span>
                                        <span style="color:#595959">(${fakeCount})</span>
                                    </div>
                                </div>
                                <div class="rc-category-badge">${item.category_name || 'Design'}</div>
                            </div>
                        </a>`;
                }).join('');

                // Wire up lazy-load for the new cards
                document.querySelectorAll('#related-grid img[data-src]').forEach(img => {
                    img.src = img.dataset.src;
                });

                // Render Side Related Grid
                const sideRelatedGrid = document.getElementById('side-related-grid');
                if (sideRelatedGrid) {
                    sideRelatedGrid.innerHTML = related.map(item => {
                        let images = [];
                        try {
                            images = item.image ? (item.image.startsWith('[') ? JSON.parse(item.image) : [item.image]) : [];
                        } catch (e) { images = [item.image]; }
                        const mainImage = images[0] || 'https://via.placeholder.com/400';
                        const hasVideo = !!item.video_url;

                        return `
                            <a href="/p/${item.slug}" class="group relative w-24 h-24 flex-shrink-0 rounded-lg overflow-hidden bg-slate-100 border border-slate-200/60 shadow-sm hover:shadow-md transition-all shimmer-sweep"
                               onmouseenter="playHoverVideo(this)" onmouseleave="pauseHoverVideo(this)">
                                <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(mainImage)}" class="w-full h-full object-contain group-hover:scale-110 transition-all duration-700" alt="Related: ${item.name} | Color Hut" title="${item.name}">
                                ${hasVideo ? `
                                    <video src="${item.video_url}" muted playsinline loop class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-300 pointer-events-none"></video>
                                    <div class="video-icon-badge absolute bottom-1 left-1 w-5 h-5 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg z-20 transition-opacity">
                                        <svg class="w-2.5 h-2.5 text-orange-600 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                    </div>
                                ` : ''}
                                <div class="absolute inset-0 ring-1 ring-inset ring-black/5 group-hover:ring-orange-500/20 rounded-lg transition-all"></div>
                            </a>`;
                    }).join('');
                    enableDragToScroll(sideRelatedGrid);
                }

            } catch (error) {
                console.error('Error initializing page:', error);
                // Redirect on error if you prefer
                // window.location.href = 'index.html';
            }
        }

        function renderGallery() {
            const container = document.getElementById('thumbnail-container');
            container.innerHTML = galleryItems.map((item, index) => {
                const isActive = index === currentMediaIndex;
                const activeClass = isActive ? 'ring-2 ring-orange-500 opacity-100' : 'opacity-60 hover:opacity-100';

                if (item.type === 'video') {
                    return `
                        <button onclick="switchMedia(${index})" class="relative w-20 h-20 lg:w-full lg:h-24 rounded-lg overflow-hidden transition-all duration-300 flex-shrink-0 border-2 ${activeClass}">
                            <div class="w-full h-full bg-slate-900 flex items-center justify-center">
                                <video data-src="${item.src}" class="w-full h-full object-cover opacity-50" muted playsinline></video>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-8 h-8 rounded-full bg-white/90 flex items-center justify-center shadow-lg backdrop-blur-sm">
                                        <svg class="w-4 h-4 text-orange-600 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                    </div>
                                </div>
                            </div>
                        </button>`;
                }

                return `
                    <button onclick="switchMedia(${index})" class="relative w-20 h-20 lg:w-full lg:h-24 rounded-lg overflow-hidden transition-all duration-300 flex-shrink-0 border-2 ${activeClass} shimmer-sweep">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(item.src)}" class="w-full h-full object-contain" width="100" height="100">
                    </button>`;
            }).join('');

            updateMainDisplay();
            enableDragToScroll(container);
        }

        function switchMedia(index) {
            currentMediaIndex = index;
            renderGallery();
        }

        function nextMedia() {
            currentMediaIndex = (currentMediaIndex + 1) % galleryItems.length;
            switchMedia(currentMediaIndex);
        }

        function prevMedia() {
            currentMediaIndex = (currentMediaIndex - 1 + galleryItems.length) % galleryItems.length;
            switchMedia(currentMediaIndex);
        }

        function updateMainDisplay() {
            const mediaContainer = document.getElementById('media-container');
            if (!mediaContainer) return;

            const item = galleryItems[currentMediaIndex];

            if (item.type === 'video') {
                mediaContainer.innerHTML = `
                    <div id="video-frame" class="w-full h-full"></div>

                `;
                const videoFrame = document.getElementById('video-frame');
                if (item.src.includes('youtube.com') || item.src.includes('youtu.be')) {
                    let videoId = '';
                    if (item.src.includes('v=')) videoId = item.src.split('v=')[1].split('&')[0];
                    else videoId = item.src.split('/').pop();
                    videoFrame.innerHTML = `<iframe class="w-full h-full" src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&playsinline=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                } else if (item.src.includes('vimeo.com')) {
                    let videoId = item.src.split('/').pop();
                    videoFrame.innerHTML = `<iframe class="w-full h-full" src="https://player.vimeo.com/video/${videoId}?autoplay=1&muted=0" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
                } else {
                    const videoEl = document.createElement('video');
                    videoEl.className = 'w-full h-full object-cover';
                    videoEl.src = item.src;
                    videoEl.loop = true;
                    videoEl.controls = true;
                    videoEl.setAttribute('controlsList', 'nodownload');
                    videoEl.oncontextmenu = (e) => e.preventDefault();
                    videoEl.setAttribute('playsinline', '');
                    videoEl.setAttribute('webkit-playsinline', '');
                    videoEl.autoplay = true;
                    videoEl.muted = false;
                    videoEl.defaultMuted = false;
                    videoFrame.appendChild(videoEl);
                    try {
                        videoEl.play().catch(e => console.log('Autoplay prevented:', e));
                    } catch (e) { console.error(e); }
                }
            } else {
                const mediaContainer = document.getElementById('media-container');
                if (mediaContainer) {
                    mediaContainer.innerHTML = `
                        <img id="product-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${item.src}" class="w-full h-full object-contain" alt="Gallery item" width="600" height="600">
                        <div id="video-frame" class="hidden w-full h-full"></div>

                    `;
                }
            }
        }

        // Search redirection
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    window.location.href = `index.html?search=${encodeURIComponent(e.target.value)}`;
                }
            });
        }

        function inquireWhatsApp() {
            const currentUrl = window.location.href;
            const phoneNumber = "8801919760626";
            const message = `Hello, I'm interested in this product ${currentUrl}. Can you please provide more information?`;
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        initPage();
    </script>
    <script src="/assets/tracker.js" defer></script>
    <script>
        // Content Protection: Block image/video save & downloader extensions
        document.addEventListener('contextmenu', e => {
            if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO' || e.target.classList.contains('watermark-overlay') || e.target.closest('.watermark-container')) {
                e.preventDefault();
            }
        });

        // Extension Guard: Periodically clear any injected downloader buttons if any
        setInterval(() => {
            const forbidden = ['download', 'save', 'ext-', 'extension'];
            document.querySelectorAll('div, button, span').forEach(el => {
                const classes = el.className.toString().toLowerCase();
                if (forbidden.some(word => classes.includes(word))) {
                    if (el.style.position === 'absolute' || el.style.position === 'fixed') {
                        el.remove();
                    }
                }
            });
        }, 1000);
    </script>
    <script src="/assets/contact-motion.js"></script>
</body>

</html>